<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body style="padding: 20px; font-family: Arial;">
    <h2>üîç –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase</h2>
    
    <div style="background: #f5f5f5; padding: 15px; margin: 20px 0; border-radius: 5px;">
        <h3>1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞</h3>
        <div id="initStatus">‚è≥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é...</div>
    </div>
    
    <div style="background: #f5f5f5; padding: 15px; margin: 20px 0; border-radius: 5px;">
        <h3>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü</h3>
        <button onclick="testTables()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã</button>
        <div id="tableStatus" style="margin-top: 10px;"></div>
    </div>
    
    <div style="background: #f5f5f5; padding: 15px; margin: 20px 0; border-radius: 5px;">
        <h3>3. –¢–µ—Å—Ç–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
        <input type="email" id="testEmail" placeholder="student@school.ru" style="padding: 8px; width: 200px;">
        <input type="password" id="testPassword" placeholder="123" style="padding: 8px; width: 200px;">
        <button onclick="testLogin()">–¢–µ—Å—Ç –≤—Ö–æ–¥–∞</button>
        <div id="loginStatus" style="margin-top: 10px;"></div>
    </div>

    <script>
        // üîê –í–†–ï–ú–ï–ù–ù–û –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª—é—á–∏ –¢–û–õ–¨–ö–û –¥–ª—è —Ç–µ—Å—Ç–∞
        // –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∞ –£–î–ê–õ–ò–¢–ï —ç—Ç–æ—Ç —Ñ–∞–π–ª!
        const TEST_SUPABASE_URL = 'https://potnqqwsaxnrrnuhoysb.supabase.co';
        const TEST_SUPABASE_KEY = '–í–ê–®_–ù–û–í–´–ô_ANON_KEY'; // –í—Å—Ç–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á —Å—é–¥–∞
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        const supabaseTest = window.supabase.createClient(TEST_SUPABASE_URL, TEST_SUPABASE_KEY);
        
        document.getElementById('initStatus').innerHTML = 
            '‚úÖ –ö–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω<br>' +
            'URL: ' + TEST_SUPABASE_URL;
        
        async function testTables() {
            const status = document.getElementById('tableStatus');
            status.innerHTML = '‚è≥ –ü—Ä–æ–≤–µ—Ä—è—é —Ç–∞–±–ª–∏—Ü—ã...';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—É users
                const { data: users, error: usersError } = await supabaseTest
                    .from('users')
                    .select('count')
                    .limit(1);
                
                if (usersError) throw new Error('users: ' + usersError.message);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—É homeworks
                const { data: homeworks, error: hwError } = await supabaseTest
                    .from('homeworks')
                    .select('count')
                    .limit(1);
                
                let result = '<h4>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:</h4>';
                
                if (!usersError) {
                    result += '‚úÖ –¢–∞–±–ª–∏—Ü–∞ <strong>users</strong> –¥–æ—Å—Ç—É–ø–Ω–∞<br>';
                }
                
                if (!hwError) {
                    result += '‚úÖ –¢–∞–±–ª–∏—Ü–∞ <strong>homeworks</strong> –¥–æ—Å—Ç—É–ø–Ω–∞<br>';
                } else {
                    result += '‚ùå –¢–∞–±–ª–∏—Ü–∞ <strong>homeworks</strong>: ' + hwError.message + '<br>';
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                const { data: testUsers } = await supabaseTest
                    .from('users')
                    .select('email, role')
                    .limit(5);
                
                result += '<h4>üë• –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</h4>';
                if (testUsers && testUsers.length > 0) {
                    testUsers.forEach(user => {
                        result += `‚Ä¢ ${user.email} (${user.role})<br>`;
                    });
                } else {
                    result += '‚ùå –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î<br>';
                    result += '<small>–î–æ–±–∞–≤—å—Ç–µ —á–µ—Ä–µ–∑ SQL: INSERT INTO users ...</small>';
                }
                
                status.innerHTML = result;
                
            } catch (error) {
                status.innerHTML = '‚ùå –û—à–∏–±–∫–∞: ' + error.message;
            }
        }
        
        async function testLogin() {
            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;
            const status = document.getElementById('loginStatus');
            
            if (!email || !password) {
                status.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å';
                return;
            }
            
            status.innerHTML = '‚è≥ –ü—Ä–æ–≤–µ—Ä—è—é –ª–æ–≥–∏–Ω...';
            
            try {
                // –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const { data, error } = await supabaseTest
                    .from('users')
                    .select('id, email, full_name, role')
                    .eq('email', email)
                    .eq('password', password)
                    .single();
                
                if (error || !data) {
                    status.innerHTML = '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å<br>' +
                                     '–ò–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î';
                    return;
                }
                
                status.innerHTML = 
                    '‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!<br>' +
                    'üë§ –ò–º—è: ' + data.full_name + '<br>' +
                    'üìß Email: ' + data.email + '<br>' +
                    'üé≠ –†–æ–ª—å: ' + data.role + '<br>' +
                    'üÜî ID: ' + data.id;
                
            } catch (error) {
                status.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ: ' + error.message;
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(testTables, 1000);
    </script>
</body>
</html>